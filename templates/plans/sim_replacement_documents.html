<!-- templates/plans/sim_replacement_documents.html -->
{% extends 'base.html' %}
{% load static %}

{% block title %}Upload Documents - SIM Replacement{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row">
        <div class="col-lg-8 mx-auto">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0"><i class="fas fa-file-upload me-2"></i>Step 2: Upload Required Documents</h4>
                </div>
                <div class="card-body p-4">
                    <!-- Request Summary -->
                    <div class="alert alert-info mb-4">
                        <h6><i class="fas fa-info-circle me-2"></i>Request Summary</h6>
                        <div class="row small mt-2">
                            <div class="col-md-6">
                                <strong>Request ID:</strong> {{ request_data.request_id }}<br>
                                <strong>Mobile Number:</strong> {{ request_data.mobile_number }}<br>
                                <strong>Operator:</strong> {{ request_data.operator|title }}<br>
                                <strong>Reason:</strong> {{ request_data.reason|title }}
                            </div>
                            <div class="col-md-6">
                                <strong>Service Type:</strong> 
                                {% if request_data.service_type == 'fast' %}
                                    Fast Track (₹199)
                                {% else %}
                                    Standard (₹99)
                                {% endif %}<br>
                                <strong>Name:</strong> {{ request_data.full_name }}<br>
                                <strong>Delivery Address:</strong> {{ request_data.city }}, {{ request_data.state }}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Document Upload Form -->
                    <form method="POST" enctype="multipart/form-data">
                        {% csrf_token %}
                        
                        {% if form.errors %}
                        <div class="alert alert-danger mb-4">
                            <strong>Please correct the errors below:</strong>
                            <ul class="mb-0">
                                {% for field in form %}
                                    {% for error in field.errors %}
                                        <li>{{ field.label }}: {{ error }}</li>
                                    {% endfor %}
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}
                        
                        <div class="mb-4">
                            <h5 class="mb-3">Upload Documents</h5>
                            
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">ID Proof *</label>
                                    <input type="file" class="form-control {% if form.id_proof.errors %}is-invalid{% endif %}" 
                                           name="id_proof" accept=".pdf,.jpg,.jpeg,.png" required>
                                    {% if form.id_proof.errors %}
                                    <div class="invalid-feedback">{{ form.id_proof.errors }}</div>
                                    {% endif %}
                                    <small class="text-muted">Aadhaar, PAN, Passport, Voter ID or Driving License (Max 5MB)</small>
                                </div>
                                
                                <div class="col-md-6">
                                    <label class="form-label">Address Proof *</label>
                                    <input type="file" class="form-control {% if form.address_proof.errors %}is-invalid{% endif %}" 
                                           name="address_proof" accept=".pdf,.jpg,.jpeg,.png" required>
                                    {% if form.address_proof.errors %}
                                    <div class="invalid-feedback">{{ form.address_proof.errors }}</div>
                                    {% endif %}
                                    <small class="text-muted">Aadhaar, Utility Bill, Passport or Bank Statement (Max 5MB)</small>
                                </div>
                                
                                <div class="col-md-6">
                                    <label class="form-label">Self Declaration Form (Optional)</label>
                                    <input type="file" class="form-control" name="declaration_form" accept=".pdf,.jpg,.jpeg,.png">
                                    <small class="text-muted">
                                        <a href="#" id="downloadForm" class="text-primary">
                                            <i class="fas fa-download me-1"></i>Download Template
                                        </a>
                                    </small>
                                </div>
                                
                                <div class="col-md-6">
                                    <label class="form-label">Passport Photo (Optional)</label>
                                    <input type="file" class="form-control" name="photo" accept=".jpg,.jpeg,.png">
                                    <small class="text-muted">Recent passport size photo (JPEG/PNG, Max 2MB)</small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Document Requirements -->
                        <div class="alert alert-warning mb-4">
                            <h6><i class="fas fa-exclamation-triangle me-2"></i>Important Notes:</h6>
                            <ul class="mb-0 small">
                                <li>Documents must be clear and readable</li>
                                <li>Maximum file size: 5MB per document</li>
                                <li>Accepted formats: PDF, JPG, JPEG, PNG</li>
                                <li>Original documents may be required during SIM delivery</li>
                                <li>Documents should be valid and not expired</li>
                            </ul>
                        </div>
                        
                        <!-- Document Checklist -->
                        <div class="card mb-4">
                            <div class="card-header bg-light">
                                <h6 class="mb-0"><i class="fas fa-check-circle me-2"></i>Document Checklist</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6 class="text-primary">ID Proof (Any One)</h6>
                                        <ul class="small mb-0">
                                            <li>Aadhaar Card</li>
                                            <li>PAN Card</li>
                                            <li>Passport</li>
                                            <li>Voter ID</li>
                                            <li>Driving License</li>
                                        </ul>
                                    </div>
                                    <div class="col-md-6">
                                        <h6 class="text-primary">Address Proof (Any One)</h6>
                                        <ul class="small mb-0">
                                            <li>Aadhaar Card</li>
                                            <li>Utility Bill (Last 3 months)</li>
                                            <li>Passport</li>
                                            <li>Bank Statement</li>
                                            <li>Ration Card</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Submit Buttons -->
                        <div class="d-flex justify-content-between">
                            <a href="{% url 'sim_replacement_create' %}" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left me-2"></i>Back to Step 1
                            </a>
                            <button type="submit" class="btn btn-primary btn-lg px-5">
                                <i class="fas fa-paper-plane me-2"></i>Submit Request & Pay ₹{{ request_data.amount_paid }}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.form-control.is-invalid {
    border-color: #dc3545;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23dc3545' stroke='none'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right calc(0.375em + 0.1875rem) center;
    background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
}
.invalid-feedback {
    display: block;
    width: 100%;
    margin-top: 0.25rem;
    font-size: 0.875em;
    color: #dc3545;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Download form template
    document.getElementById('downloadForm').addEventListener('click', function(e) {
        e.preventDefault();
        alert('Self Declaration Form template will be downloaded. In a real application, this would initiate a file download.');
        // Here you would typically redirect to a file download URL
        // window.location.href = "{% static 'docs/sim_declaration_form.pdf' %}";
    });
    
    // File size validation
    const fileInputs = document.querySelectorAll('input[type="file"]');
    fileInputs.forEach(input => {
        input.addEventListener('change', function() {
            const file = this.files[0];
            if (file) {
                const maxSize = 5 * 1024 * 1024; // 5MB
                if (file.size > maxSize) {
                    alert('File size should not exceed 5MB');
                    this.value = ''; // Clear the file input
                }
                
                // Check file type
                const allowedTypes = ['application/pdf', 'image/jpeg', 'image/jpg', 'image/png'];
                if (!allowedTypes.includes(file.type)) {
                    alert('Please upload only PDF, JPG, JPEG, or PNG files');
                    this.value = '';
                }
            }
        });
    });
});
</script>
{% endblock %}